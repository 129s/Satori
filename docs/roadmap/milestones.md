# 任务与里程碑

## M1: KS 最小原型 ✅
- [x] 建立基础工程结构（CMake + src/main.cpp）
- [x] 实现 KarplusStrongString（可设置频率、阻尼、持续时间）
- [x] 实现 WaveWriter，输出 16-bit PCM WAV
- [x] 在 main 中串起流程，支持简单命令行参数
- [x] 跑通单弦测试（如 A4=440Hz，时长 2 秒）并验证输出

## M2: 声音设计扩展（进行中）
- [x] 可插拔滤波器链（首个一阶低通）
- [x] 弦模型参数化（拾音点、噪声类型、随机种子）
- [x] 增加多复音调度，允许同时触发多根弦
- [ ] 扩展噪声模型（粉噪/可配置谱形）
- [ ] 多复音限幅或简易 limiter，保证输出峰值

> **验收标准**  
> - CLI/Win32 两端均可通过参数触发多复音  
> - 自动测试新增“能量限制/削波检测”用例  
> - README/架构文档同步说明新参数

## M3: 环境与交互
1. 加入卷积混响（可读取 IR 文件）
2. 增加键盘/简单 MIDI 输入到触发层
3. 打包示范预设与文档

> **验收标准**  
> - 新增 `FX::ConvolutionReverb` 占位实现被替换为最小卷积器  
> - `win/app` 或 CLI 提供不少于 3 个示范预设（YAML/JSON）  
> - 文档描述“参数-预设”数据流，并提供示例文件

## M4: Win32 GUI 与实时音频（规划中）
1. 拆分 `core` 静态库，复用到 CLI/Win32 双前端 ✅
2. 封装 WASAPI（或 XAudio2）`AudioEngine`，提供事件触发与线程安全参数同步 ✅
3. 构建 WinMain + 消息循环骨架，管理 COM 初始化、窗口生命周期与音频引擎绑定（已提供键盘触发 demo） ✅
4. 建立 Direct2D 自绘 UI：旋钮/滑块、波形监视、虚拟键盘，支持参数-引擎联动 ✅（滑块 + 波形视图 + 虚拟键盘 + 预设按钮已落地）
5. 支持预设存储（JSON/YAML）与最小打包脚本，产出独立 EXE 演示 ✅（`presets/*.json` 与 `scripts/package_win.ps1`）
6. 完善实时音频诊断与日志，解决“引擎启动失败”问题，并在无设备环境下优雅降级 ⏳（UI 状态提示 + 离线模式已上线，后续仍需更细粒度的日志与自动降级策略）

> **验收标准**  
> - UI 具备：参数滑块、波形/电平监视器、虚拟键盘，其状态可与引擎双向同步  
> - `docs/troubleshooting` 更新并与错误提示联动（HRESULT 映射、常见处理）  
> - `SatoriWin` 支持无声卡 fallback（跳过渲染但 UI 可用），并输出详尽日志

## 待办池
- 音频参数配置文件（YAML/JSON）
- 自动化测试：波形能量/时长校验
- 引入 CI，构建并上传演示 WAV
- 评估 DirectWrite 文本渲染与多语言字体策略
- 设计 UI 皮肤系统与快捷键映射
- 提供 WASAPI mock 或测试跳过机制，保证 headless 环境流水线可运行
- 增加 `docs/troubleshooting` 章节，覆盖非 Windows 平台可能的兼容性问题
